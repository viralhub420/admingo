<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AdminGo Mini App</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="//libtl.com/sdk.js" data-zone="10580727" data-sdk="show_10580727"></script>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #74ebd5, #ACB6E5);
  min-height: 100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.card {
  background:#fff;
  border-radius:20px;
  padding:20px;
  width:100%;
  max-width:420px;
  box-shadow:0 6px 25px rgba(0,0,0,0.3);
  display:flex;
  flex-direction:column;
  gap:15px;
  text-align:center;
}
.balance {
  background: linear-gradient(45deg,#FFD700,#FF8C00);
  padding:20px;
  border-radius:15px;
  font-size:22px;
  font-weight:bold;
  color:white;
  box-shadow:0 6px 20px rgba(0,0,0,0.3);
}
.grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
.btn, .full-btn {
  padding:15px;
  border-radius:12px;
  font-weight:bold;
  cursor:pointer;
  transition:all 0.2s;
  text-align:center;
}
.btn:hover, .full-btn:hover { transform:scale(1.05); }
.green{background:#2ecc71; color:white;}
.blue{background:#3498db; color:white;}
.purple{background:#9b59b6; color:white;}
.orange{background:#e67e22; color:white;}
.yellow{background:#f1c40f; color:black;}
.red{background:#e74c3c; color:white;}
.full-btn{grid-column:1/3;}
.modal {
  display:none;
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.7);
  justify-content:center; align-items:center;
}
.modal-content {
  background:#fff; color:#000;
  padding:20px; border-radius:15px;
  max-width:400px; width:90%;
  text-align:left;
}
.modal-content h3 { margin-bottom:10px; }
.modal-content button { margin-top:10px; padding:10px 15px; border:none; border-radius:10px; cursor:pointer; background:#e74c3c; color:white; }
</style>
</head>

<body>
<div class="card">
  <h2 id="welcome">Loading...</h2>
  <div class="balance">Balance: <span id="balance">0</span> coins</div>

  <div class="full-btn orange" onclick="invite()">üîó Invite Friends & Earn</div>
  <div class="full-btn green" onclick="dailyBonus()">üéÅ Daily Bonus (+20)</div>

  <div class="grid">
    <div class="btn blue" onclick="earn('Watch Ad',10)">üí∞ Watch Ad +10</div>
    <div class="btn purple" onclick="earn('Spin & Earn',15)">üéØ Spin & Earn +15</div>
    <div class="btn yellow" onclick="earn('Lucky Box',25)">üéÅ Lucky Box +25</div>
    <div class="btn orange" onclick="earn('Video Quest',12)">üé¨ Video Quest +12</div>
    <div class="btn purple" onclick="earn('Challenge Reward',18)">üèÜ Challenge +18</div>
    <div class="btn blue" onclick="earn('Mini Game Bonus',22)">üéÆ Mini Game +22</div>
  </div>

  <div class="full-btn red" onclick="showRules()">üìú Rules & Regulations</div>
</div>

<!-- Rules Modal -->
<div id="rulesModal" class="modal">
  <div class="modal-content">
    <h3>Rules & Regulations</h3>
    <ol>
      <li>Withdraw minimum: 5000 coins per transaction.</li>
      <li>Daily Bonus: Only once every 24 hours.</li>
      <li>Ad rewards: Points added after watching ad.</li>
      <li>Invite Friends: +50 coins per successful referral.</li>
      <li>Mini Games / Challenges: No cheating allowed.</li>
      <li>Coins can only be used in app or withdrawn.</li>
    </ol>
    <button onclick="closeRules()">Close</button>
  </div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();

const API = "https://admingo.onrender.com"; // Backend URL
const user = tg.initDataUnsafe.user;

if(!user){ document.body.innerHTML="<h2>Please open from Telegram!</h2>"; }
else{
  document.getElementById("welcome").innerText = `Welcome ${user.first_name}`;
  loadBalance();
}

// Load Balance
async function loadBalance(){
  const res = await fetch(`${API}/getBalance?telegramId=${user.id}`);
  const data = await res.json();
  document.getElementById("balance").innerText = data.balance || 0;
}

// Earn Points (after ad)
async function earn(name, points){
  if(typeof show_10580727==="function") show_10580727();
  setTimeout(async ()=>{
    await fetch(`${API}/addCoins`,{
      method:"POST",
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({telegramId:user.id,amount:points})
    });
    loadBalance();
  },4000);
}

// Daily Bonus
async function dailyBonus(){
  await fetch(`${API}/dailyBonus`,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({telegramId:user.id})
  });
  loadBalance();
}

// Invite Friend
function invite(){
  const link = `https://t.me/Tetris1earnbot?start=ref_${user.id}`;
  tg.openTelegramLink(link);
}

// Rules Modal
function showRules(){ document.getElementById("rulesModal").style.display='flex'; }
function closeRules(){ document.getElementById("rulesModal").style.display='none'; }

// Referral Auto-Verify
if(tg.initDataUnsafe.start_param?.startsWith("ref_")){
  fetch(`${API}/referral`,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      userId:user.id,
      referrerId: tg.initDataUnsafe.start_param.replace("ref_","")
    })
  });
}
</script>
</body>
  </html>
