<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AdminGo Mini App</title>

<!-- Telegram Mini App SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- Monetag SDK -->
<script src="https://libtl.com/sdk.js" data-zone="10580727" data-sdk="show_10580727"></script>

<style>
body {
  background:#0f0f0f;
  color:#fff;
  font-family: 'Segoe UI', sans-serif;
  text-align:center;
  margin:0; padding:15px;
}
h3 { margin:10px 0; }

/* Balance card */
.balance-card {
  background: linear-gradient(135deg,#0088cc,#005f91);
  padding:25px;
  border-radius:20px;
  margin-bottom:20px;
  box-shadow:0 10px 20px rgba(0,0,0,0.3);
}
.balance-card h1 { font-size:42px; margin:10px 0; }

/* Referral */
.refer-section {
  background:#1e1e1e;
  padding:15px;
  border-radius:15px;
  margin-bottom:20px;
  border:1px dashed #0088cc;
}

/* Buttons Grid */
.btn-grid {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-bottom:20px;
}
button {
  padding:16px;
  border:none;
  border-radius:15px;
  font-weight:bold;
  cursor:pointer;
  font-size:14px;
  color:white;
  transition:0.2s;
}
button:active { transform:scale(0.95); }

.btn-earning { font-size:16px; }
.btn-main { background:#27ae60; }
.btn-game { background:#2980b9; }
.btn-offer { background:#8e44ad; }
.btn-ad { background:#f1c40f; color:#000; }

.btn-ref { background:#f39c12; grid-column: span 2; }
.btn-withdraw { background:#e67e22; grid-column: span 2; }
.btn-contact { background:#16a085; grid-column: span 2; }
.btn-admin { background:#d35400; grid-column: span 2; display:none; }
.btn-rules { background:#e74c3c; grid-column: span 2; margin-top:10px; }
</style>
</head>
<body>

<h3>Welcome, <span id="userName">User</span>!</h3>

<div class="balance-card">
  <p>Current Balance</p>
  <h1 id="userBalance">0</h1>
</div>

<div class="refer-section">
  <p style="margin:0 0 10px 0; font-size:14px; color:#f1c40f;">ğŸ à¦ªà§à¦°à¦¤à¦¿ à¦°à§‡à¦«à¦¾à¦°à§‡ à¦ªà¦¾à¦¨ à§§à§¦à§¦ à¦ªà¦¯à¦¼à§‡à¦¨à§à¦Ÿ!</p>
  <button class="btn-ref" onclick="shareReferral()">ğŸ”— Invite Friends & Earn</button>
</div>

<!-- Earning buttons -->
<div class="btn-grid" id="earningButtons"></div>

<!-- Single buttons -->
<div class="btn-grid" id="singleButtons">
  <button class="btn-withdraw" onclick="withdrawCoins()">ğŸ’° Withdraw</button>
  <button class="btn-contact" onclick="contactUs()">ğŸ“© Contact / Complaint</button>
  <button id="adminBtn" class="btn-admin" onclick="toggleAdmin()">ğŸ›  Admin Panel</button>
  <button class="btn-rules" onclick="showRules()">ğŸ“œ Rules & Info</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// Firebase init
firebase.initializeApp({ 
  apiKey: "AIzaSyD8ZSiPZ9HDJV1qGznPOBAu2qYN9lmSqWU", 
  authDomain: "skbd355-reward-app.firebaseapp.com", 
  projectId: "skbd355-reward-app" 
});
const db = firebase.firestore();

// Telegram Mini App
const tg = window.Telegram.WebApp;
tg.ready();
const user = tg.initDataUnsafe?.user;
let userRef;
let balance = 0;

if(user){
  document.getElementById("userName").innerText = user.first_name;
  userRef = db.collection("users").doc(String(user.id));
  if(user.id === 6311806060) document.getElementById("adminBtn").style.display="block";

  // Listen for balance updates
  userRef.onSnapshot(doc => {
      if(doc.exists) document.getElementById("userBalance").innerText = doc.data().balance;
  });
}

// Earning buttons data
const earningButtonsData = [
  {name:"ğŸ’° Watch Ad", points:15, link:"https://otieu.com/4/10540712", cls:"btn-ad"},
  {name:"ğŸ¯ Spin & Earn", points:20, link:"https://otieu.com/4/10235751", cls:"btn-game"},
  {name:"ğŸ“¦ Daily Bonus", points:20, link:"https://otieu.com/4/10540712", cls:"btn-main"},
  {name:"ğŸ Lucky Box", points:25, link:"https://otieu.com/4/10453524", cls:"btn-offer"},
  {name:"ğŸ¬ Video Quest", points:12, link:"https://otieu.com/4/10540712", cls:"btn-main"},
  {name:"ğŸ† Challenge Reward", points:18, link:"https://otieu.com/4/10540712", cls:"btn-game"},
  {name:"ğŸ•¹ï¸ Mini Game Bonus", points:22, link:"https://otieu.com/4/10540712", cls:"btn-offer"}
];

function awardCoins(points, link, taskName){
  // Monetag ad
  if(typeof show_10580727==="function") show_10580727();
  tg.openLink(link);

  setTimeout(()=>{
    if(confirm(`ğŸ‰ ${taskName}: +${points} coins! Accept?`)){
      userRef.update({balance: firebase.firestore.FieldValue.increment(points)});
    }
  },2000);
}

// Render earning buttons
const earningDiv = document.getElementById("earningButtons");
earningButtonsData.forEach(b=>{
  const btn = document.createElement("button");
  btn.className = "btn-earning "+b.cls;
  btn.innerText = `${b.name} (+${b.points})`;
  btn.onclick = ()=>awardCoins(b.points, b.link, b.name);
  earningDiv.appendChild(btn);
});

// Referral
function shareReferral(){
  const inviteLink = `https://t.me/skbd355_bot?start=${user.id}`;
  tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(inviteLink)}&text=Join and Earn!`);
}

// Withdraw
function withdrawCoins(){
  userRef.get().then(doc=>{
      if(doc.data().balance<5000) return alert("âš ï¸ à¦…à¦¨à§à¦¤à¦¤ à§«à§¦à§¦à§¦ à¦ªà§Ÿà§‡à¦¨à§à¦Ÿ à¦ªà§à¦°à§Ÿà§‹à¦œà¦¨!");
      let method = prompt("à¦ªà§‡à¦®à§‡à¦¨à§à¦Ÿ à¦®à¦¾à¦§à§à¦¯à¦® (bkash/nagad/rocket):");
      if(method){
          let num = prompt(method.toUpperCase()+" à¦¨à¦¾à¦®à§à¦¬à¦¾à¦° à¦¦à¦¿à¦¨:");
          if(num && num.length>=11){
              db.collection("withdraws").add({
                  user_id:user.id, number:num, amount:5000, method:method.toLowerCase(), status:"pending", timestamp:new Date()
              }).then(()=> userRef.update({balance: firebase.firestore.FieldValue.increment(-5000)}));
              alert("âœ… Withdraw request successful!");
          }
      }
  });
}

// Contact
function contactUs(){ alert("ğŸ“© Send your complaint or feedback here!"); }

// Admin panel
function toggleAdmin(){
  db.collection("withdraws").where("status","==","pending").get().then(snap=>{
      let list="ğŸ“¢ Pending Withdraws:\n\n";
      snap.forEach(doc=>{
          let d=doc.data();
          list+=`ğŸ“± ${d.method.toUpperCase()}: ${d.number}\nğŸ’° Amt: ${d.amount}\n\n`;
      });
      alert(list||"No pending withdraw requests.");
  });
}

// Rules
function showRules(){
  alert("ğŸ“œ Rules:\n1. Watch ad fully.\n2. Wait at least required seconds.\n3. Use proper steps to earn coins.");
}

// Telegram MainButton
tg.MainButton.setText("ğŸ’° WITHDRAW MONEY").show().onClick(()=>withdrawCoins());
tg.expand();
</script>

</body>
  </html>
