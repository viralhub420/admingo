<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admingo</title>

<!-- Telegram WebApp -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- Monetag Ad Script -->
<script src="//libtl.com/sdk.js" data-zone="10580727" data-sdk="show_10580727" onload="adLoaded=true"></script>

<style>
body{
  margin:0;
  background:#0b0b0b;
  font-family:Arial;
  color:white;
}
.container{padding:15px}
.balance{
  background:#0277bd;
  padding:25px;
  border-radius:15px;
  text-align:center;
  font-size:28px;
}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
.btn{
  padding:18px;
  border-radius:12px;
  text-align:center;
  font-weight:bold;
  cursor:pointer;
}
.green{background:#2ecc71}
.blue{background:#3498db}
.purple{background:#9b59b6}
.orange{background:#e67e22}
.yellow{background:#f1c40f;color:black}
.red{background:#e74c3c}
.full{grid-column:1/3}
</style>
</head>

<body>
<div class="container">
  <div class="balance">
    Current Balance<br>
    <span id="balance">0</span>
  </div>

  <div class="btn orange full" onclick="invite()">ğŸ”— Invite Friends & Earn</div>
  <div class="btn green full" onclick="daily()">ğŸ Daily Bonus (+20)</div>

  <div class="grid">
    <div class="btn blue" onclick="earn(10)">ğŸ’° Watch Ad +10</div>
    <div class="btn purple" onclick="earn(15)">ğŸ¯ Spin & Earn +15</div>
    <div class="btn yellow" onclick="earn(25)">ğŸ Lucky Box +25</div>
    <div class="btn orange" onclick="earn(12)">ğŸ¬ Video Quest +12</div>
    <div class="btn purple" onclick="earn(18)">ğŸ† Challenge +18</div>
    <div class="btn blue" onclick="earn(22)">ğŸ® Mini Game +22</div>
    <div class="btn red full" onclick="withdrawPrompt()">ğŸ’¸ Withdraw</div>
    <div class="btn green full" onclick="adminPanel()">ğŸ›  Admin Panel</div>
    <div class="btn yellow full" onclick="rules()">ğŸ“œ Rules & Regulations</div>
  </div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();

const user = tg.initDataUnsafe.user;
const API = "https://admingo.onrender.com";

/* ========== Load Balance ========== */
async function loadBalance(){
  const r = await fetch(`${API}/getBalance?telegramId=${user.id}`);
  const d = await r.json();
  document.getElementById("balance").innerText = d.balance;
}

/* ========== Earn Coins ========== */
async function earn(points) {
  // à§§. à¦šà§‡à¦• à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡ Monetag à¦…à§à¦¯à¦¾à¦¡ à¦«à¦¾à¦‚à¦¶à¦¨à¦Ÿà¦¿ à¦¬à§à¦°à¦¾à¦‰à¦œà¦¾à¦°à§‡ à¦²à§‹à¦¡ à¦¹à§Ÿà§‡à¦›à§‡ à¦•à¦¿ à¦¨à¦¾
  if (typeof show_10580727 === "function") {
    
    // à§¨. à¦…à§à¦¯à¦¾à¦¡ à¦¦à§‡à¦–à¦¾à¦¨à§‹à¦° à¦šà§‡à¦·à§à¦Ÿà¦¾ à¦•à¦°à¦¾ à¦¹à¦šà§à¦›à§‡
    show_10580727().then(() => {
      // à¦¯à¦¦à¦¿ à¦…à§à¦¯à¦¾à¦¡à¦Ÿà¦¿ à¦¸à¦«à¦²à¦­à¦¾à¦¬à§‡ à¦¦à§‡à¦–à¦¾à¦¨à§‹ à¦¶à§‡à¦· à¦¹à§Ÿ (Reward Condition)
      addPointsToDatabase(points);
    }).catch((err) => {
      // à¦¯à¦¦à¦¿ à¦…à§à¦¯à¦¾à¦¡ à¦²à§‹à¦¡ à¦¹à¦¤à§‡ à¦¸à¦®à¦¸à§à¦¯à¦¾ à¦¹à§Ÿ (à¦¯à§‡à¦®à¦¨: No Fill à¦¬à¦¾ Network Error)
      alert("à¦…à§à¦¯à¦¾à¦¡ à¦²à§‹à¦¡ à¦¹à¦¤à§‡ à¦ªà¦¾à¦°à¦›à§‡ à¦¨à¦¾à¥¤ à¦†à¦¬à¦¾à¦° à¦šà§‡à¦·à§à¦Ÿà¦¾ à¦•à¦°à§à¦¨à¥¤");
    });

  } else {
    // à¦¸à§à¦•à§à¦°à¦¿à¦ªà§à¦Ÿ à¦¬à§à¦²à¦• à¦¥à¦¾à¦•à¦²à§‡ à¦¬à¦¾ à¦²à§‹à¦¡ à¦¨à¦¾ à¦¹à¦²à§‡
    alert("à¦…à§à¦¯à¦¾à¦¡ à¦¸à§à¦•à§à¦°à¦¿à¦ªà§à¦Ÿ à¦ªà¦¾à¦“à§Ÿà¦¾ à¦¯à¦¾à¦šà§à¦›à§‡ à¦¨à¦¾à¥¤ à¦†à¦ªà¦¨à¦¾à¦° AdBlocker à¦¬à¦¨à§à¦§ à¦•à¦°à§à¦¨à¥¤");
  }
}

// à§©. à¦¡à¦¾à¦Ÿà¦¾à¦¬à§‡à¦¸à§‡ à¦•à§Ÿà§‡à¦¨ à¦ªà¦¾à¦ à¦¾à¦¨à§‹à¦° à¦œà¦¨à§à¦¯ à¦†à¦²à¦¾à¦¦à¦¾ à¦«à¦¾à¦‚à¦¶à¦¨
async function addPointsToDatabase(points) {
  try {
    const response = await fetch(API + "/addCoins", {
      method: "POST",
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ telegramId: user.id, amount: points })
    });
    
    if (response.ok) {
      loadBalance(); // à¦¸à§à¦•à§à¦°à¦¿à¦¨à§‡ à¦¬à§à¦¯à¦¾à¦²à§‡à¦¨à§à¦¸ à¦†à¦ªà¦¡à§‡à¦Ÿ à¦•à¦°à¦¬à§‡
      tg.showAlert(`à¦…à¦­à¦¿à¦¨à¦¨à§à¦¦à¦¨! à¦†à¦ªà¦¨à¦¿ ${points} à¦•à§Ÿà§‡à¦¨ à¦ªà§‡à§Ÿà§‡à¦›à§‡à¦¨à¥¤`);
    }
  } catch (error) {
    console.error("Coin add failed:", error);
  }
}
  

  // Coins add after ad duration
  setTimeout(async ()=>{
    await fetch(API+"/addCoins",{
      method:"POST",
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({telegramId:user.id,amount:points})
    });
    loadBalance();
  },4000); // adjust if ad takes longer
}

/* ========== Daily Bonus ========== */
async function daily(){
  await fetch(API+"/dailyBonus",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({telegramId:user.id})
  });
  loadBalance();
}

/* ========== Invite ========== */
function invite(){
  const link = `https://t.me/Tetris1earnbot?start=ref_${user.id}`;
  tg.openTelegramLink(link);
}

/* ========== Withdraw ========== */
async function withdrawPrompt(){
  const amount = prompt("Enter amount to withdraw:");
  const method = prompt("Enter method (Bkash/Nagad/Rocket):");
  const number = prompt("Enter number:");
  if(!amount || !method || !number) return;

  const r = await fetch(API+"/withdraw",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      telegramId:user.id,
      amount:Number(amount),
      method,
      number
    })
  });
  const d = await r.json();
  if(d.success) alert("Withdraw request sent!");
  loadBalance();
}

/* ========== Admin Panel ========== */
async function adminPanel(){
  const withdrawId = prompt("Enter Withdraw ID:");
  const action = prompt("Enter action (approve/reject):");
  if(!withdrawId || !action) return;

  const r = await fetch(API+"/admin/withdraws",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({ withdrawId, action })
  });
  const d = await r.json();
  if(d.success) alert(`Withdraw ${action}ed!`);
}

/* ========== Rules ========== */
function rules(){
  alert("Rules & Regulations:\n1. Earn coins by watching ads...\n2. Withdraw rules...");
}

/* ========== Referral detect ========== */
if(tg.initDataUnsafe.start_param?.startsWith("ref_")){
  fetch(API+"/referral",{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      userId:user.id,
      referrerId:tg.initDataUnsafe.start_param.replace("ref_","")
    })
  });
}

/* ========== Initial Load ========== */
loadBalance();
</script>
</body>
</html>
