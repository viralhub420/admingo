<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AdminGo Mini App</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="//libtl.com/sdk.js" data-zone="10580727" data-sdk="show_10580727"></script>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#74ebd5,#ACB6E5);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.card{
  background:#fff;
  width:100%;
  max-width:420px;
  border-radius:20px;
  padding:20px;
  box-shadow:0 10px 25px rgba(0,0,0,.3);
  text-align:center;
}
.balance-card{
  background:linear-gradient(45deg,#FFD700,#FF8C00);
  color:#fff;
  padding:20px;
  border-radius:16px;
  font-size:22px;
  font-weight:bold;
  margin-bottom:15px;
}
#buttons{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
.btn{
  border:none;
  border-radius:14px;
  padding:16px;
  font-weight:bold;
  color:#fff;
  cursor:pointer;
}
.single-area{
  margin-top:15px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.single-btn{
  border:none;
  border-radius:14px;
  padding:16px;
  font-weight:bold;
  color:#fff;
  cursor:pointer;
}
.watch{background:#FF6B6B;}
.spin{background:#6BCB77;}
.daily{background:#4D96FF;}
.lucky{background:#FFD93D;color:#333;}
.video{background:#FF6EC7;}
.challenge{background:#FF9F1C;}
.mini{background:#845EC2;}
.invite{background:#00C9A7;}
.withdraw{background:#FF595E;}
.rules{background:#333;}
.contact{background:#FFB547;color:#333;}
.points{display:block;font-size:13px;opacity:.8;}
</style>
</head>

<body>
<div class="card">
  <h2 id="welcome">Loading...</h2>
  <div id="balance" class="balance-card">Balance: 0</div>

  <div id="buttons"></div>

  <div class="single-area">
    <button class="single-btn invite" onclick="inviteFriend()">Invite Friend (+50)</button>
    <button class="single-btn withdraw" onclick="withdraw()">Withdraw</button>
    <button class="single-btn rules" onclick="showRules()">Rules</button>
    <button class="single-btn contact" onclick="alert('Contact Admin')">Contact</button>
  </div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();

let balance = 0;
const user = tg.initDataUnsafe?.user;

if(!user){
  document.body.innerHTML = "<h2>Open from Telegram</h2>";
}

// ---------- LOAD BALANCE ----------
async function loadBalance(){
  const res = await fetch(`https://admingo.onrender.com/getBalance?telegramId=${user.id}`);
  const data = await res.json();
  balance = data.balance || 0;
  document.getElementById("balance").innerText = `Balance: ${balance} coins`;
}

// ---------- ADD COINS ----------
async function addCoins(amount){
  await fetch("https://admingo.onrender.com/addCoins",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ telegramId:user.id, amount })
  });
  balance += amount;
  document.getElementById("balance").innerText = `Balance: ${balance} coins`;
}

// ---------- MONETAG ----------
function earn(points){
  if(typeof show_10580727 === "function") show_10580727();
  addCoins(points);
}

// ---------- INVITE (REAL REFERRAL) ----------
function inviteFriend(){
  const link = `https://t.me/Tetris1earnbot?start=${user.id}`;
  tg.openTelegramLink(link);
}

// ---------- WITHDRAW ----------
function withdraw(){
  if(balance < 5000){
    alert("Minimum 5000 coins required");
    return;
  }
  tg.sendData(JSON.stringify({ action:"withdraw", amount:5000 }));
  alert("Withdraw request sent");
}

// ---------- RULES ----------
function showRules(){
  alert("Withdraw = 5000 coins\nFake activity = ban");
}

// ---------- UI ----------
document.getElementById("welcome").innerText = `Welcome ${user.first_name}`;

loadBalance();

// ðŸ”¥ AUTO REFERRAL VERIFY (VERY IMPORTANT)
fetch("https://admingo.onrender.com/verifyReferral",{
  method:"POST",
  headers:{ "Content-Type":"application/json" },
  body:JSON.stringify({ telegramId:user.id })
});

// ---------- EARN BUTTONS ----------
const buttons = [
  ["Watch Ad",10,"watch"],
  ["Spin & Earn",15,"spin"],
  ["Daily Bonus",20,"daily"],
  ["Lucky Box",25,"lucky"],
  ["Video Quest",12,"video"],
  ["Challenge",18,"challenge"],
  ["Mini Game",22,"mini"]
];

const btnDiv = document.getElementById("buttons");
buttons.forEach(b=>{
  const btn=document.createElement("button");
  btn.className=`btn ${b[2]}`;
  btn.innerHTML=`${b[0]}<span class="points">+${b[1]} coins</span>`;
  btn.onclick=()=>earn(b[1]);
  btnDiv.appendChild(btn);
});
</script>
</body>
</html>
